{% extends "base.html" %}

{% block header %}Capture Settings{% endblock %}

{% block content %}
<div class="settings-container">
    <h2>Capture Settings</h2>
    <div class="settings-form">
        <div class="form-group">
            <label for="interface">Network Interface</label>
            <select id="interface" class="settings-input"></select>
        </div>
        <button id="saveSettings" class="btn-primary">Save Settings</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('load', async () => {
        const interfaceSelect = document.getElementById('interface');

        // Load available interfaces
        let interfaces = [];
        try {
            const resp = await fetch('/api/network_interfaces');
            interfaces = (await resp.json()).interfaces || [];
        } catch (e) {
            console.error('Failed to load network interfaces:', e);
        }

        // Load current settings
        let currentInterface = '';
        try {
            const settings = await fetch('/api/capture/settings').then(r => r.json());
            currentInterface = settings.interface;
        } catch (error) {
            console.error('Failed to load settings:', error);
        }

        // Populate select
        interfaceSelect.innerHTML = '';
        interfaces.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            if (name === currentInterface) opt.selected = true;
            interfaceSelect.appendChild(opt);
        });

        // Save settings
        document.getElementById('saveSettings').onclick = async () => {
            try {
                const response = await fetch('/api/capture/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ interface: interfaceSelect.value })
                });

                const result = await response.json();
                if (result.success) {
                    showNotification('Settings saved successfully', 'success');
                } else {
                    showNotification('Failed to save settings', 'error');
                }
            } catch (error) {
                console.error('Failed to save settings:', error);
                showNotification('Failed to save settings', 'error');
            }
        };
    });

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.querySelector('.settings-container').appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }
</script>
{% endblock %}